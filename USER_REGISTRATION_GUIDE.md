# 用户注册与审核流程指南

## 📋 概述

已实现双轨制用户注册流程：
1. **自主注册**：用户注册后默认为"待审核"状态，无法登录，需管理员审核。
2. **管理员创建**：管理员可直接创建用户，状态默认为"正常"，可直接登录。

## 🔧 核心变更

### 1. 用户状态常量 (models/user.go)

```go
const (
    UserStatusDisabled = 0 // 禁用
    UserStatusActive   = 1 // 正常
    UserStatusPending  = 2 // 待审核
)
```

### 2. API 接口变更

#### A. 用户自主注册
- **接口**: `POST /api/v1/register`
- **行为**: 创建用户，状态设置为 `2` (Pending)。
- **响应**: "注册成功，请等待管理员审核"。

#### B. 管理员创建用户
- **接口**: `POST /api/v1/users`
- **权限**: 需要 `user:create` 权限。
- **行为**: 创建用户，状态设置为 `1` (Active)。
- **响应**: "用户创建成功"。

#### C. 审核用户
- **接口**: `POST /api/v1/users/:id/approve`
- **权限**: 需要 `user:approve` 权限。
- **行为**: 将用户状态从 `2` (Pending) 改为 `1` (Active)。
- **响应**: "用户审核通过"。

### 3. 登录逻辑更新

`UserService.Login` 方法已更新：
- 检查用户状态。
- 如果状态为 `0` (Disabled)，返回 "用户已被禁用"。
- 如果状态为 `2` (Pending)，返回 "用户待审核，请联系管理员"。
- 仅状态为 `1` (Active) 时允许登录。

## 🚀 使用流程

### 场景一：用户自主注册

1. 用户调用 `POST /api/v1/register` 提交注册信息。
2. 系统返回注册成功提示，但在数据库中状态为 `2`。
3. 用户尝试登录，系统返回错误提示 "用户待审核"。
4. 管理员调用 `POST /api/v1/users/:id/approve` 审核通过。
5. 用户再次登录，成功获取 Token。

### 场景二：管理员后台添加

1. 管理员调用 `POST /api/v1/users` 提交用户信息。
2. 系统创建用户，状态直接设为 `1`。
3. 该用户可立即登录系统。

## 📚 Swagger 文档

已更新 Swagger 文档，包含新增的管理员接口。请访问 `/swagger/index.html` 查看详情。
