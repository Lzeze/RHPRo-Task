# å®¡æ ¸æµç¨‹è°ƒæ•´è¯´æ˜

## ğŸ“‹ è°ƒæ•´æ¦‚è¿°

æ ¹æ®æ‚¨çš„åé¦ˆï¼Œå·²ä¼˜åŒ–å®¡æ ¸æµç¨‹ï¼Œä½¿å…¶æ›´åŠ è‡ªåŠ¨åŒ–å’Œçµæ´»ã€‚

## ğŸ”„ ä¸»è¦å˜æ›´

### å˜æ›´1ï¼šæäº¤ç›®æ ‡/æ–¹æ¡ˆåè‡ªåŠ¨å‘èµ·å®¡æ ¸

**ä¹‹å‰çš„æµç¨‹ï¼š**
```
æäº¤ç›®æ ‡å’Œæ–¹æ¡ˆ â†’ æ‰‹åŠ¨è°ƒç”¨å‘èµ·å®¡æ ¸æ¥å£ â†’ å¼€å§‹å®¡æ ¸
```

**ç°åœ¨çš„æµç¨‹ï¼š**
```
æäº¤ç›®æ ‡å’Œæ–¹æ¡ˆ â†’ è‡ªåŠ¨å‘èµ·å•äººå®¡æ ¸ â†’ åˆ›å»ºäººå®¡æ ¸
```

**ä¼˜åŠ¿ï¼š**
- âœ… å‡å°‘ä¸€æ¬¡APIè°ƒç”¨
- âœ… æµç¨‹æ›´è‡ªç„¶ï¼Œæ— éœ€æ‰‹åŠ¨è§¦å‘
- âœ… é»˜è®¤å•äººå®¡æ ¸ï¼Œæ•ˆç‡æ›´é«˜

### å˜æ›´2ï¼šæ”¯æŒåŠ¨æ€é‚€è¯·é™ªå®¡å›¢

**ä¹‹å‰ï¼š**
- å‘èµ·å®¡æ ¸æ—¶å¿…é¡»å†³å®šæ˜¯å•äººè¿˜æ˜¯é™ªå®¡å›¢æ¨¡å¼
- ä¸€æ—¦ç¡®å®šæ— æ³•æ›´æ”¹

**ç°åœ¨ï¼š**
- æäº¤ç›®æ ‡/æ–¹æ¡ˆåè‡ªåŠ¨ä»¥**å•äººæ¨¡å¼**å‘èµ·å®¡æ ¸
- åˆ›å»ºäººå®¡æ ¸æ—¶ï¼Œå¦‚éœ€è¦é™ªå®¡å›¢æ„è§ï¼Œå¯éšæ—¶**é‚€è¯·é™ªå®¡å›¢**
- å®¡æ ¸ä¼šè¯è‡ªåŠ¨ä» `single` æ¨¡å¼è½¬ä¸º `jury` æ¨¡å¼

**ä¼˜åŠ¿ï¼š**
- âœ… æ›´çµæ´»çš„å†³ç­–æµç¨‹
- âœ… åˆ›å»ºäººå¯æ ¹æ®å®é™…æƒ…å†µå†³å®šæ˜¯å¦éœ€è¦é™ªå®¡å›¢
- âœ… é¿å…ä¸å¿…è¦çš„é™ªå®¡å›¢å®¡æ ¸

## ğŸ†• æ–°å¢åŠŸèƒ½

### é‚€è¯·é™ªå®¡å›¢æ¥å£

**æ¥å£ï¼š** `POST /api/v1/review-sessions/:sessionId/invite-jury`

**è¯´æ˜ï¼š** åˆ›å»ºäººå°†å•äººå®¡æ ¸è½¬ä¸ºé™ªå®¡å›¢å®¡æ ¸

**æƒé™ï¼š** ä»»åŠ¡åˆ›å»ºäºº

**è¯·æ±‚ä½“ï¼š**
```json
{
  "jury_member_ids": [5, 7, 9],
  "required_approvals": 2
}
```

**å­—æ®µè¯´æ˜ï¼š**
- `jury_member_ids`: é™ªå®¡å›¢æˆå‘˜ç”¨æˆ·IDåˆ—è¡¨
- `required_approvals`: éœ€è¦çš„é€šè¿‡ç¥¨æ•°

**å“åº”ï¼š**
```json
{
  "code": 200,
  "message": "é™ªå®¡å›¢é‚€è¯·æˆåŠŸ",
  "data": null
}
```

**æ•ˆæœï¼š**
- å®¡æ ¸ä¼šè¯çš„ `review_mode` ä» `single` å˜ä¸º `jury`
- ä¸ºæ¯ä¸ªé™ªå®¡å›¢æˆå‘˜åˆ›å»º `task_participants` è®°å½•ï¼ˆrole=juryï¼‰
- é™ªå®¡å›¢æˆå‘˜å¯æäº¤å®¡æ ¸æ„è§
- åˆ›å»ºäººç»¼åˆè€ƒè™‘ååšå‡ºæœ€ç»ˆå†³ç­–

## ğŸ“Š æ–°çš„å®¡æ ¸æµç¨‹å¯¹æ¯”

### å•äººå®¡æ ¸æµç¨‹ï¼ˆé»˜è®¤ï¼‰

```mermaid
graph TD
    A[æäº¤ç›®æ ‡å’Œæ–¹æ¡ˆ] --> B[è‡ªåŠ¨å‘èµ·å•äººå®¡æ ¸]
    B --> C[åˆ›å»ºäººå®¡æ ¸]
    C --> D{é€šè¿‡?}
    D -->|æ˜¯| E[è¿›å…¥ä¸‹ä¸€é˜¶æ®µ]
    D -->|å¦| F[é©³å›é‡æ–°æäº¤]
```

### é™ªå®¡å›¢å®¡æ ¸æµç¨‹ï¼ˆæŒ‰éœ€ï¼‰

```mermaid
graph TD
    A[æäº¤ç›®æ ‡å’Œæ–¹æ¡ˆ] --> B[è‡ªåŠ¨å‘èµ·å•äººå®¡æ ¸]
    B --> C{åˆ›å»ºäººåˆ¤æ–­}
    C -->|éœ€è¦é™ªå®¡å›¢| D[é‚€è¯·é™ªå®¡å›¢]
    D --> E[é™ªå®¡å›¢æŠ•ç¥¨]
    E --> F[åˆ›å»ºäººæœ€ç»ˆå†³ç­–]
    F --> G{é€šè¿‡?}
    G -->|æ˜¯| H[è¿›å…¥ä¸‹ä¸€é˜¶æ®µ]
    G -->|å¦| I[é©³å›é‡æ–°æäº¤]
    
    C -->|ä¸éœ€è¦| J[åˆ›å»ºäººç›´æ¥å†³ç­–]
    J --> G
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1ï¼šç®€å•éœ€æ±‚ï¼ˆå•äººå®¡æ ¸ï¼‰

```bash
# æ­¥éª¤1ï¼šæ‰§è¡Œäººæäº¤ç›®æ ‡å’Œæ–¹æ¡ˆ
POST /api/v1/tasks/1/goals
{
  "goals": [...],
  "solution": {...}
}
# è‡ªåŠ¨åˆ›å»ºå®¡æ ¸ä¼šè¯ï¼ˆå•äººæ¨¡å¼ï¼‰

# æ­¥éª¤2ï¼šåˆ›å»ºäººç›´æ¥å®¡æ ¸å†³ç­–
POST /api/v1/review-sessions/1/finalize
{
  "approved": true,
  "comment": "æ–¹æ¡ˆå¯è¡Œï¼Œé€šè¿‡"
}
```

### åœºæ™¯2ï¼šå¤æ‚éœ€æ±‚ï¼ˆéœ€è¦é™ªå®¡å›¢ï¼‰

```bash
# æ­¥éª¤1ï¼šæ‰§è¡Œäººæäº¤ç›®æ ‡å’Œæ–¹æ¡ˆ
POST /api/v1/tasks/1/goals
{
  "goals": [...],
  "solution": {...}
}
# è‡ªåŠ¨åˆ›å»ºå®¡æ ¸ä¼šè¯ï¼ˆå•äººæ¨¡å¼ï¼‰

# æ­¥éª¤2ï¼šåˆ›å»ºäººé‚€è¯·é™ªå®¡å›¢
POST /api/v1/review-sessions/1/invite-jury
{
  "jury_member_ids": [5, 7, 9],
  "required_approvals": 2
}
# å®¡æ ¸ä¼šè¯è½¬ä¸ºé™ªå®¡å›¢æ¨¡å¼

# æ­¥éª¤3ï¼šé™ªå®¡å›¢æˆå‘˜æŠ•ç¥¨
POST /api/v1/review-sessions/1/opinion
{ "opinion": "approve", "comment": "æŠ€æœ¯æ–¹æ¡ˆåˆç†" }

# æ­¥éª¤4ï¼šåˆ›å»ºäººç»¼åˆé™ªå®¡å›¢æ„è§ï¼Œåšæœ€ç»ˆå†³ç­–
POST /api/v1/review-sessions/1/finalize
{
  "approved": true,
  "comment": "ç»¼åˆé™ªå®¡å›¢æ„è§ï¼Œæ–¹æ¡ˆé€šè¿‡"
}
```

## ğŸ”§ ä»£ç å˜æ›´è¯¦æƒ…

### 1. TaskFlowService.SubmitGoalsAndSolution

**æ–°å¢é€»è¾‘ï¼š**
```go
// æäº¤æ–¹æ¡ˆåï¼Œè‡ªåŠ¨åˆ›å»ºå®¡æ ¸ä¼šè¯
reviewSession := &models.ReviewSession{
    TaskID:            taskID,
    ReviewType:        "goal_review",
    TargetType:        "requirement_solutions",
    TargetID:          solution.ID,
    InitiatedBy:       userID,
    InitiatedAt:       now,
    Status:            "in_review",
    ReviewMode:        "single",  // é»˜è®¤å•äººæ¨¡å¼
    RequiredApprovals: 1,
}
```

### 2. TaskFlowService.InviteJuryMembersï¼ˆæ–°å¢æ–¹æ³•ï¼‰

**åŠŸèƒ½ï¼š** å°†å•äººå®¡æ ¸è½¬ä¸ºé™ªå®¡å›¢å®¡æ ¸

**å…³é”®é€»è¾‘ï¼š**
- éªŒè¯åˆ›å»ºäººæƒé™
- æ£€æŸ¥å®¡æ ¸ä¼šè¯çŠ¶æ€å¿…é¡»ä¸º `in_review`
- æ›´æ–° `review_mode` ä¸º `jury`
- åˆ›å»ºé™ªå®¡å›¢æˆå‘˜çš„ `task_participants` è®°å½•

## ğŸ“ API æ¥å£æ±‡æ€»

| æ–¹æ³• | è·¯å¾„ | å˜æ›´ | è¯´æ˜ |
|------|------|------|------|
| POST | `/api/v1/tasks/:id/goals` | **å·²ä¼˜åŒ–** | æäº¤åè‡ªåŠ¨å‘èµ·å•äººå®¡æ ¸ |
| POST | `/api/v1/tasks/:id/review` | ä¿ç•™ | ä»å¯ç‹¬ç«‹å‘èµ·å®¡æ ¸ï¼ˆæ‰§è¡Œè®¡åˆ’ç­‰ï¼‰ |
| POST | `/api/v1/review-sessions/:sessionId/invite-jury` | **æ–°å¢** | é‚€è¯·é™ªå®¡å›¢ï¼ˆå•äººè½¬é™ªå®¡å›¢ï¼‰ |
| POST | `/api/v1/review-sessions/:sessionId/opinion` | ä¸å˜ | é™ªå®¡å›¢æˆå‘˜æäº¤æ„è§ |
| POST | `/api/v1/review-sessions/:sessionId/finalize` | ä¸å˜ | åˆ›å»ºäººæœ€ç»ˆå†³ç­– |

## âœ… éªŒè¯ç»“æœ

- âœ… ä»£ç ç¼–è¯‘é€šè¿‡
- âœ… Swagger æ–‡æ¡£å·²æ›´æ–°
- âœ… æ‰€æœ‰æ¥å£è·¯ç”±å·²é…ç½®

## ğŸ¯ åç»­å»ºè®®

å¦‚æœéœ€è¦å¯¹æ‰§è¡Œè®¡åˆ’å®¡æ ¸ä¹Ÿåº”ç”¨ç›¸åŒçš„æµç¨‹ï¼Œå¯ä»¥ï¼š
1. åˆ›å»º `SubmitExecutionPlan` æ–¹æ³•
2. æäº¤è®¡åˆ’åè‡ªåŠ¨å‘èµ·å•äººå®¡æ ¸
3. åŒæ ·æ”¯æŒé‚€è¯·é™ªå®¡å›¢

è¿™æ ·å¯ä»¥ä¿æŒæ•´ä¸ªå®¡æ ¸æµç¨‹çš„ä¸€è‡´æ€§ã€‚
